# Расширенная архитектура бота

## Обновленная структура workflow

### БЛОК 1: ТОЧКА ВХОДА
- Приветствие и сегментация пользователей
- Три основных пути:
  - Путь А: "У меня есть задача для бота" (Квалификация)
  - Путь Б: "Хочу посмотреть примеры/возможности" (Демонстрация)
  - Путь В: "Связаться с разработчиком" (Прямой контакт)

### БЛОК 2: ВЕТКА КВАЛИФИКАЦИИ (Путь А)
- Шаг 2.1: Определение типа задачи (Боль клиента)
- Шаг 2.2: Определение контекста (Сфера бизнеса)
- Шаг 2.3: Оценка масштаба (Серьезность намерений)
- Шаг 2.4: Выдача ценности и Пред-CTA

### БЛОК 3: ВЕТКА ДЕМОНСТРАЦИИ (Путь Б)
- Галерея возможностей бота
- Демонстрация конкретных функций
- Перевод на ветку квалификации

### БЛОК 4: ПРЯМОЙ КОНТАКТ (Конверсия в заявку)
- Получение финального подтверждения
- Сбор сообщения от пользователя
- Передача лида

### БЛОК 5: ПРОГРЕВ (Для "подумающих")
- Предложение подписки на полезные материалы
- Добавление в базу для "прогревающей" рассылки

### БЛОК 6: ПЕРЕДАЧА ЛИДА
- Сбор и структурирование данных
- Присвоение скоринга
- Формирование "Карточки лида"
- Отправка разработчику

## Расширенная доменная модель

### Новые сущности

1. **LeadProfile** - Профиль потенциального клиента
   - UserID и Username в Telegram
   - Выбранный путь (Path)
   - Определенная боль (Pain_Point)
   - Ниша (Niche)
   - Масштаб (Scale)
   - Сообщение пользователя (User_Message)
   - Температура лида (LeadTemperature)

2. **LeadScoring** - Система оценки качества лида
   - Правила присвоения температуры
   - Алгоритм расчета скоринга

3. **Demonstration** - Система демонстраций
   - Каталог возможностей бота
   - Медиа-контент для демонстраций
   - Статистика по демонстрациям

### Обновленные сущности

1. **DialogSession** - Расширенная сессия диалога
   - Поддержка всех блоков workflow
   - Трекинг пути пользователя
   - Сохранение промежуточных результатов

2. **User** - Расширенный пользователь
   - Подписка на "прогревающую" рассылку
   - История взаимодействий
   - Статус воронки

## Расширенные DTO

### Platform-agnostic DTOs

1. **SegmentationChoiceDto** - Выбор при сегментации
2. **QualificationQuestionDto** - Вопрос в ветке квалификации
3. **DemonstrationGalleryDto** - Галерея демонстраций
4. **LeadCaptureDto** - Захват лида
5. **WarmupSubscriptionDto** - Подписка на прогрев
6. **LeadCardDto** - Карточка лида

## Новые порты

### Ведомые порты

1. **showSegmentationPort** - Отображение вариантов сегментации
2. **showQualificationQuestionPort** - Отображение вопросов квалификации
3. **showDemonstrationGalleryPort** - Отображение галереи демонстраций
4. **showDemonstrationDetailPort** - Отображение деталей демонстрации
5. **captureLeadPort** - Захват лида
6. **showWarmupSubscriptionPort** - Предложение подписки на прогрев
7. **transferLeadPort** - Передача лида разработчику

### Ведущие порты

1. **segmentationChoicePort** - Получение выбора при сегментации
2. **qualificationAnswerPort** - Получение ответов на вопросы квалификации
3. **demonstrationChoicePort** - Получение выбора демонстрации
4. **leadSubmissionPort** - Получение заявки от пользователя
5. **warmupSubscriptionPort** - Получение согласия на подписку

## Use Cases

### Основные use cases

1. **handleSegmentationUseCase** - Обработка сегментации пользователя
2. **handleQualificationUseCase** - Обработка ветки квалификации
3. **handleDemonstrationUseCase** - Обработка ветки демонстрации
4. **handleLeadCaptureUseCase** - Обработка захвата лида
5. **handleWarmupSubscriptionUseCase** - Обработка подписки на прогрев
6. **transferLeadUseCase** - Передача лида разработчику

## Driving Adapters

### Telegram Driving Adapter
- Преобразование всех новых DTO в Telegram-специфичный формат
- Обработка всех новых callback'ов
- Интеграция с Telegram Bot API

## Driven Adapters

### Lead Transfer Adapter
- Формирование карточки лида
- Отправка разработчику через Telegram
- Логирование передачи

### Warmup Subscription Adapter
- Добавление пользователя в список рассылки
- Управление подпиской

### Demonstration Content Adapter
- Хранение и предоставление медиа-контента
- Управление галереей демонстраций
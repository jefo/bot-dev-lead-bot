# Onboarding Guide для ИИ-Агента

Этот документ — главная точка входа для понимания проекта. Он содержит высокоуровневый обзор и ссылки на ключевые файлы, которые служат исполняемой спецификацией.

## 1. Видение проекта (The "Why")

Наша цель — разработка ядра для создания платформо-независимых ботов. В основе лежат два ключевых Bounded Context:

1.  **`Chat`**: Низкоуровневый контекст, описывающий универсальный протокол общения между "Персонами". Он ничего не знает о ботах или пользователях.
2.  **`BotPersona`**: Контекст-движок, который исполняет декларативную модель беседы (граф UI-компонентов) для реализации конкретного бота.

Наш текущий проект, **бот-квалификатор**, является пилотной реализацией `BotPersona` поверх ядра `Chat`.

> **Полное видение описано в [PRD.md](./PRD.md)**

## 2. Структура кода (The "Where")

Проект разделен на два основных пакета:
- `packages/chat`: Ядро, реализующее контекст "Chat".
- `app/bot`: Прикладной бот-квалификатор, реализующий контекст "BotPersona".

В обоих пакетах используется слоистая архитектура:
- `src/domain/`: Чистая бизнес-логика и правила (Сущности).
- `src/application/`: Оркестрация (Use Cases, Порты, DTO).
- `src/infrastructure/`: Взаимодействие с внешним миром (Адаптеры к Telegram, UI-компоненты).
- `src/composition/`: Сборка зависимостей (Dependency Injection).

## 3. Как это работает (The "How")

Лучший способ понять систему — изучить ее тесты. Они являются исполняемой спецификацией.

### Ключевые тесты

1.  **Тест ядра `Chat`**: `packages/chat/src/receive-incoming-message.use-case.test.ts`
    - **Что показывает:** Как ядро обрабатывает первое и последующие сообщения от любой "Персоны". Демонстрирует базовую логику создания чатов и сохранения состояния.
    - **[Изучить тест](./packages/chat/src/receive-incoming-message.use-case.test.ts)**

2.  **Тест логики бота-квалификатора**: `app/bot/src/application/application.test.ts`
    - **Что показывает:** Как работает многошаговая логика диалога в изоляции от инфраструктуры. Демонстрирует взаимодействие use case'ов и портов в рамках конкретной бизнес-задачи.
    - **[Изучить тест](./app/bot/src/application/application.test.ts)**

3.  **Тест UI (Презентеры)**: `app/bot/src/infrastructure/telegram/presenters.test.ts`
    - **Что показывает:** Как наши UI-компоненты преобразуются в реальные JSON-объекты для отправки в Telegram API. Здесь можно понять, как выглядит "view" нашего бота.
    - **[Изучить тест](./app/bot/src/infrastructure/telegram/presenters.test.ts)**

4.  **Тест роутинга (Контроллер)**: `app/bot/src/infrastructure/telegram/controllers.test.ts`
    - **Что показывает:** Как "сырые" данные из Telegram (`callback_query`, `message`) преобразуются и направляются в правильный use case. 
    - **[Изучить тест](./app/bot/src/infrastructure/telegram/controllers.test.ts)**

## 4. Как запустить

- **Запустить тесты:** `bun test`
- **Запустить эхо-бота (ядро `Chat`):** `bun packages/chat/run.ts` (требуется `TELEGRAM_BOT_TOKEN`)
